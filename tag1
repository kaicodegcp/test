docker images | grep amazonaws.com | while read repo tag img_id rest; do
  # Extract just the 'cloudera/...' part from the full path
  short_name=$(echo "$repo" | sed -n 's|.*/cloudera[_/]|\0|p' | sed 's|.*/||')
  namespace=$(echo "$repo" | grep -o 'cloudera[_/][^ ]*' | sed 's|cloudera[_/]||')
  clean_repo="cloudera_${namespace:-unknown}"

  final_tag="sd-wv58-kflz.nam.nsroot.net:5000/$clean_repo:$tag"

  echo "🔖 Tagging $repo:$tag → $final_tag"
  docker tag "$repo:$tag" "$final_tag"
done

docker images | grep sd-wv58-kflz.nam.nsroot.net | while read repo tag img_id rest; do
  echo "⬆️  Pushing $repo:$tag"
  docker push $repo:$tag
done
