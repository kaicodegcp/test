Step 1: Transfer New Certs to Admin Host
From your Docker server (sd-wv58-kflz.nam.nsroot.net):

bash
Copy
Edit
scp /opt/registry/certs/domain.crt root@bdgtr076x11t1.nam.nsroot.net:/tmp/
scp /opt/registry/certs/ca.crt root@bdgtr076x11t1.nam.nsroot.net:/tmp/
ðŸ”¹ Step 2: Log in to the Admin Host
bash
Copy
Edit
ssh root@bdgtr076x11t1.nam.nsroot.net
ðŸ”¹ Step 3: Create ConfigMap in OpenShift (openshift-config)
This will update the cluster-wide CA bundle to trust your TLS cert.

bash
Copy
Edit
oc create configmap custom-ca \
  --from-file=ca-bundle.crt=/tmp/domain.crt \
  -n openshift-config --dry-run=client -o yaml | oc apply -f -
Use domain.crt if it has all required SANs for API server, registry, etc.

ðŸ”¹ Step 4: Patch OpenShift Proxy to Use the Custom CA
bash
Copy
Edit
oc patch proxy/cluster --type=merge -p '{"spec":{"trustedCA":{"name":"custom-ca"}}}'
ðŸ”¹ Step 5: Verify Patch
bash
Copy
Edit
oc get proxy/cluster -o jsonpath='{.spec.trustedCA.name}'
# Expected Output: custom-ca
ðŸ”¹ Step 6: Trust the CA on Host OS (Optional but Safe)
Copy CA into system trust and extract:

bash
Copy
Edit
cp /tmp/domain.crt /etc/pki/ca-trust/source/anchors/domain.crt
update-ca-trust extract
ðŸ”¹ Step 7: Restart CDS-Related Pods (e.g., Vault, Console)
If already deployed:

bash
Copy
Edit
oc delete pod vault-0 -n <cdp-namespace>
oc delete pod <cds-console-pod> -n <cdp-namespace>
ðŸ”¹ Step 8: Re-run CDS Install
Go back to the Cloudera Manager web UI and Retry the installation from the "Installation Progress" step.

ðŸ§ª Optional: Test API Trust Manually
bash
Copy
Edit
curl -v https://api.<cluster-name>:6443 --cacert /tmp/domain.crt
Should return 200 OK or valid TLS handshake.

=================================================================


Fix: Build Full Certificate Chain for Trust
ðŸ”¹ Step 1: Concatenate Full Chain
Letâ€™s build a proper CA bundle (trusted chain):

bash
Copy
Edit
cat /opt/registry/certs/ca.crt /opt/cloudera/security/x509/root_ca_cert.pem > /tmp/ca-bundle.crt
If ca.crt already contains the intermediate cert, and root_ca_cert.pem is your root, this forms the full chain.

ðŸ”¹ Step 2: Verify the Chain is Valid
bash
Copy
Edit
openssl verify -CAfile /tmp/ca-bundle.crt /opt/registry/certs/domain.crt
Expected output:

swift
Copy
Edit
/opt/registry/certs/domain.crt: OK
ðŸ”¹ Step 3: Apply to System Trust Store
bash
Copy
Edit
cp /tmp/ca-bundle.crt /etc/pki/ca-trust/source/anchors/ca-bundle.crt
update-ca-trust extract
This will include your updated cert chain in:

swift
Copy
Edit
/etc/pki/tls/certs/ca-bundle.crt
ðŸ”¹ Step 4: Final Curl Validation
bash
Copy
Edit
curl -v https://console-openshift-console.apps.mlab-ctigtdcai03d.ecs.dyn.nsroot.net:6443
âœ… If no self signed certificate error is shown, youâ€™re good to go.

Optional Verification: See Server-Provided Cert Chain
If still unsure, run:

bash
Copy
Edit
openssl s_client -connect console-openshift-console.apps.mlab-ctigtdcai03d.ecs.dyn.nsroot.net:6443 -showcerts
This shows what the server sends vs whatâ€™s missing from your CA bundle.




