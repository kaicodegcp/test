openssl x509 -in /opt/cloudera/security/x509/root_ca_cert.pem -text -noout

echo | openssl s_client -connect bigdataplatform-tts-dev2-livy.nam.nsroot.net:28998 -showcerts

curl --negotiate -u : -X POST \
  -H "Content-Type: application/json" \
  -d '{"kind": "spark"}' \
  https://bigdataplatform-tts-dev2-livy.nam.nsroot.net:28998/sessions \
  --cacert /opt/cloudera/security/x509/root_ca_cert.pem \
  -L -v

openssl s_client -connect bigdataplatform-tts-dev2-livy.nam.nsroot.net:28998 -CAfile /opt/cloudera/security/x509/root_ca_cert.pem

curl --negotiate -u : -X POST \
  -H "Content-Type: application/json" \
  -d '{"kind": "spark"}' \
  https://bdgtr091xl5t2.nam.nsroot.net:28998/sessions \
  --cacert /opt/cloudera/security/x509/root_ca_cert.pem \
  --resolve bdgtr091xl5t2.nam.nsroot.net:28998:168.72.239.218 \
  -L -v



Next Steps: Use the Newly Generated Certs in Livy
üîç Step 1: Verify the cert includes the correct SAN
Run this on the node where the .pem is placed:

bash
Copy
Edit
openssl x509 -in <your-new-cert>.pem -noout -text | grep -A1 "Subject Alternative Name"
You must see:

ruby
Copy
Edit
DNS:bigdataplatform-tts-dev2-livy.nam.nsroot.net
üîß Step 2: Copy the required certs to your Livy server (if not already there)
Example:

bash
Copy
Edit
# Copy cert, key, and CA cert to the correct path
cp /path/to/new-cert.pem      /opt/cloudera/security/x509/livy.crt
cp /path/to/new-key.key       /opt/cloudera/security/x509/livy.key
cp /path/to/ca-cert.pem       /opt/cloudera/security/x509/root_ca_cert.pem

# Fix permissions
chmod 600 /opt/cloudera/security/x509/livy.key
chmod 644 /opt/cloudera/security/x509/livy.crt /opt/cloudera/security/x509/root_ca_cert.pem
‚öôÔ∏è Step 3: Configure Livy in Cloudera Manager
Go to:

CM Admin Console ‚Üí Spark 3 ‚Üí Configuration
Search for: TLS or SSL and set:

Property	Set Value
Livy TLS/SSL Server Certificate File	/opt/cloudera/security/x509/livy.crt
Livy TLS/SSL Server Private Key File	/opt/cloudera/security/x509/livy.key
Livy TLS/SSL CA Certificate File	/opt/cloudera/security/x509/root_ca_cert.pem

Click Save Changes.

üîÅ Step 4: Restart Livy Service
Go to Spark 3 ‚Üí Instances ‚Üí Livy Server ‚Üí Actions ‚Üí Restart

‚úÖ Step 5: Test curl with CA cert and Load Balancer FQDN
bash
Copy
Edit
curl --negotiate -u : -X POST \
  -H "Content-Type: application/json" \
  -d '{"kind": "spark"}' \
  https://bigdataplatform-tts-dev2-livy.nam.nsroot.net:28998/sessions \
  --cacert /opt/cloudera/security/x509/root_ca_cert.pem \
  -L -v
You should no longer get the SSL: no alternative certificate subject name error.


