Step-by-Step Deployment
1. Create a ConfigMap with the domain.crt
bash
Copy
Edit
oc create configmap docker-registry-cert \
  --from-file=domain.crt=/opt/registry/certs/domain.crt \
  -n openshift-config
2. Create a DaemonSet YAML to distribute the cert
Save the following as trust-cert-daemonset.yaml:

yaml
Copy
Edit
apiVersion: apps/v1
kind: DaemonSet
metadata:
  name: cert-installer
  namespace: openshift-config
spec:
  selector:
    matchLabels:
      name: cert-installer
  template:
    metadata:
      labels:
        name: cert-installer
    spec:
      hostPID: true
      containers:
      - name: install-cert
        image: registry.access.redhat.com/ubi8/ubi
        command: ["/bin/bash", "-c"]
        args:
          - |
            set -ex
            cp /certs/domain.crt /host/etc/docker/certs.d/sd-wv58-kflz.nam.nsroot.net:5000/ca.crt
            cp /certs/domain.crt /host/etc/pki/ca-trust/source/anchors/domain.crt
            chroot /host update-ca-trust extract
            chroot /host systemctl restart crio
            sleep 300
        securityContext:
          privileged: true
        volumeMounts:
        - name: certs
          mountPath: /certs
        - name: host-etc-docker
          mountPath: /host/etc/docker
        - name: host-etc-pki
          mountPath: /host/etc/pki
        - name: host-sysroot
          mountPath: /host
      volumes:
      - name: certs
        configMap:
          name: docker-registry-cert
      - name: host-etc-docker
        hostPath:
          path: /etc/docker
      - name: host-etc-pki
        hostPath:
          path: /etc/pki
      - name: host-sysroot
        hostPath:
          path: /
      tolerations:
      - operator: Exists
      restartPolicy: Always
3. Apply the DaemonSet
bash
Copy
Edit
oc apply -f trust-cert-daemonset.yaml
It will run once on each node, copy the cert, restart crio, and wait.

4. Verify and Cleanup
✅ Check certs:
bash
Copy
Edit
oc debug node/<node-name>
chroot /host ls /etc/docker/certs.d/sd-wv58-kflz.nam.nsroot.net:5000/
✅ Then delete DaemonSet:
bash
Copy
Edit
oc delete ds cert-installer -n openshift-config
oc delete configmap docker-registry-cert -n openshift-config
✅ After That
Re-deploy your failing pod:

bash
Copy
Edit
oc delete pod vault-0 -n nacho-cds
Image pull should succeed without TLS error.
